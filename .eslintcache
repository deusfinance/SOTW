[{"E:\\deus\\vote.deus.finance\\src\\index.js":"1","E:\\deus\\vote.deus.finance\\src\\reportWebVitals.js":"2","E:\\deus\\vote.deus.finance\\src\\routes\\index.js":"3","E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\StonksOfWeek.js":"4","E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\Footer\\Footer.js":"5","E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\Header\\Header.js":"6","E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\MainBody\\MainBody.js":"7","E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\FooterItemList\\FooterItemList.js":"8","E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\RankItem\\RankItem.js":"9","E:\\deus\\vote.deus.finance\\src\\components\\Button\\Button.js":"10","E:\\deus\\vote.deus.finance\\src\\components\\PageNavigation\\PageNavigation.js":"11"},{"size":525,"mtime":1611984416065,"results":"12","hashOfConfig":"13"},{"size":375,"mtime":1611984416068,"results":"14","hashOfConfig":"13"},{"size":351,"mtime":1611984416069,"results":"15","hashOfConfig":"13"},{"size":1381,"mtime":1611984416065,"results":"16","hashOfConfig":"13"},{"size":1925,"mtime":1611984416066,"results":"17","hashOfConfig":"13"},{"size":2964,"mtime":1611984416067,"results":"18","hashOfConfig":"13"},{"size":9731,"mtime":1611984416067,"results":"19","hashOfConfig":"13"},{"size":598,"mtime":1611984416066,"results":"20","hashOfConfig":"13"},{"size":1414,"mtime":1611984416068,"results":"21","hashOfConfig":"13"},{"size":633,"mtime":1611984416049,"results":"22","hashOfConfig":"13"},{"size":5584,"mtime":1611984416049,"results":"23","hashOfConfig":"13"},{"filePath":"24","messages":"25","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},"1kfwym3",{"filePath":"27","messages":"28","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},{"filePath":"29","messages":"30","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},{"filePath":"31","messages":"32","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},{"filePath":"35","messages":"36","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},{"filePath":"37","messages":"38","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"39","usedDeprecatedRules":"26"},{"filePath":"40","messages":"41","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},{"filePath":"42","messages":"43","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},{"filePath":"44","messages":"45","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"26"},{"filePath":"46","messages":"47","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"E:\\deus\\vote.deus.finance\\src\\index.js",[],["48","49"],"E:\\deus\\vote.deus.finance\\src\\reportWebVitals.js",[],"E:\\deus\\vote.deus.finance\\src\\routes\\index.js",[],"E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\StonksOfWeek.js",[],"E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\Footer\\Footer.js",[],"E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\Header\\Header.js",[],"E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\MainBody\\MainBody.js",["50","51"],"import React, {useState, useEffect, useCallback} from 'react';\r\nimport Web3 from 'web3'\r\nimport Spinner from 'react-spinkit';\r\n\r\nimport Button from 'components/Button/Button';\r\nimport PageNavigation from 'components/PageNavigation/PageNavigation';\r\nimport { ReactComponent as StonksIcon } from 'icons/STONKS.svg';\r\nimport RankItem from '../RankItem/RankItem';\r\nimport styles from './MainBody.module.scss';\r\n\r\nconst size = 10;\r\n\r\nexport default function MainBody({account: address}) {\r\n  const [searchInput, setSearchInput] = useState('');\r\n  const [modalShow, setModalShow] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [stocks, setStocks] = useState([]);\r\n  const [searchStocks, setSearchStocks] = useState([]);\r\n  const [firstItem, setFirstItem] = useState({});\r\n  const [voteItem, setVoteItem] = useState({});\r\n  const [pages, setPages] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const getStocks = useCallback(() => {\r\n    return new Promise((resolve, reject) => {\r\n      const apiUrl = 'https://weeklystocks-api.herokuapp.com/stocks?search='+searchInput+'&offset='+(searchInput ? 0 : (currentPage - 1) * size + 1)+'&limit='+size+'&sort=' + (searchInput ? 'ticker,asc' : 'vote.numberOfVotes,desc&sort=ticker,asc');\r\n      fetch(apiUrl, {\r\n        method: 'GET',\r\n        headers: {\r\n          api_key: process.env.REACT_APP_API_KEY,\r\n          Accept: '*/*',\r\n          'Content-Type': 'application/json',\r\n        },\r\n      }).then(data => {\r\n        return data.json();\r\n      }).then(resp => {\r\n        if(searchInput) {\r\n          setSearchStocks(resp.stocks)\r\n        } else {\r\n          setStocks(resp.stocks)\r\n          setPages(resp.totalPages)\r\n        }\r\n        resolve(true)\r\n      }).catch(err => {\r\n        // consolg.log('getStocks err', err)\r\n        reject(err)\r\n      })\r\n    })\r\n  }, [currentPage, searchInput])\r\n\r\n  const getFirstItem = useCallback(() => {\r\n    return new Promise((resolve, reject) => {\r\n      const apiUrl = 'https://weeklystocks-api.herokuapp.com/stocks?search=&offset=0&limit=1&sort=vote.numberOfVotes,desc&sort=ticker,asc';\r\n      fetch(apiUrl, {\r\n        method: 'GET',\r\n        headers: {\r\n          api_key: process.env.REACT_APP_API_KEY,\r\n          Accept: '*/*',\r\n          'Content-Type': 'application/json',\r\n        },\r\n      }).then(data => {\r\n        return data.json();\r\n      }).then(resp => {\r\n        setFirstItem(resp.stocks[0]);\r\n        resolve();\r\n      }).catch(err => {\r\n        // consolg.log('getFirstItem err', err)\r\n        reject();\r\n      })\r\n    })\r\n  }, []);\r\n\r\n  const getVotes = useCallback(() => {\r\n    return new Promise((resolve, reject) => {\r\n      if(address) {\r\n        setLoading(true);\r\n        const apiUrl = 'https://weeklystocks-api.herokuapp.com/wallets/' + address + '/votes';\r\n        fetch(apiUrl, {\r\n          method: 'GET',\r\n          headers: {\r\n            api_key: process.env.REACT_APP_API_KEY,\r\n            Accept: '*/*',\r\n            'Content-Type': 'application/json',\r\n          },\r\n        }).then(data => {\r\n          if(data.status === 200) {\r\n            return data.json();\r\n          } else {\r\n            return {}\r\n          }\r\n        }).then(resp => {\r\n          setVoteItem(resp);\r\n          resolve();\r\n        }).catch(err => {\r\n          // consolg.log('getVotes err', err)\r\n          reject();\r\n        })\r\n      } else {\r\n        resolve();\r\n      }\r\n    })\r\n  }, [address]);\r\n\r\n  const getData = useCallback(() => {\r\n    setLoading(true);\r\n    getStocks().then(() => {\r\n      getFirstItem().then(() => {\r\n        getVotes().then(() => {\r\n          setLoading(false);\r\n        })\r\n      })\r\n    })\r\n  }, [getStocks, getFirstItem, getVotes]);\r\n\r\n  useEffect(() => {\r\n    getData();\r\n  }, [getData]);\r\n\r\n  const onChangeInput = (value) => {\r\n    setSearchInput(value);\r\n    if (value) {\r\n      document.body.style.overflow = 'hidden';\r\n      setModalShow(true);\r\n    } else {\r\n      hideModal();\r\n    }\r\n  }\r\n\r\n  const hideModal = () => {\r\n    document.body.style.overflow = 'unset';\r\n    setModalShow(false);\r\n  }\r\n\r\n  const onVote = async (item) => {\r\n    if(!address) {\r\n      alert('Please install metamask on your browser');\r\n      return\r\n    }\r\n    if(!voteItem.id) {\r\n      setLoading(true);\r\n      const apiUrl = 'https://weeklystocks-api.herokuapp.com/wallets/'+address+'/stocks/'+item.id.toString()+'/votes';\r\n      const web3 = new Web3(Web3.givenProvider || 'http://localhost:8080')\r\n      const signature = await web3.eth.personal.sign(item.ticker.toString(), address)\r\n      fetch(apiUrl, {\r\n        method: 'PUT',\r\n        headers: {\r\n          api_key: process.env.REACT_APP_API_KEY,\r\n          Accept: '*/*',\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          address: address,\r\n          message: item.ticker.toString(),\r\n          signature: signature,\r\n          version: \"2\"\r\n        })\r\n      }).then(data => {\r\n        if(data.ok) {\r\n          // alert('You\\'ve voted');\r\n          getData();\r\n        } else {\r\n          setLoading(false)\r\n        }\r\n      }).catch(err => {\r\n        // consolg.log('onVote err', err)\r\n        setLoading(false);\r\n      })\r\n    } else {\r\n      alert('You\\'ve already voted already for this week');\r\n    }\r\n  }\r\n\r\n  const retractVote = async () => {\r\n    setLoading(true);\r\n    const apiUrl = 'https://weeklystocks-api.herokuapp.com/wallets/'+address+'/stocks/'+voteItem.id.toString()+'/votes';\r\n    const web3 = new Web3(Web3.givenProvider || 'http://localhost:8080')\r\n    const signature = await web3.eth.personal.sign(voteItem.ticker.toString(), address)\r\n    fetch(apiUrl, {\r\n      method: 'DELETE',\r\n      headers: {\r\n        api_key: process.env.REACT_APP_API_KEY,\r\n        Accept: '*/*',\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        address: address,\r\n        message: voteItem.ticker.toString(),\r\n        signature: signature,\r\n        version: \"2\"\r\n      })\r\n    }).then(data => {\r\n      if(data.ok) {\r\n        // alert('You\\'ve retracted');\r\n        getData();\r\n      } else {\r\n        setLoading(false);\r\n      }\r\n    }).catch(err => {\r\n      // consolg.log('retractVote err', err)\r\n      setLoading(false);\r\n    })\r\n  }\r\n\r\n  const getSearchArray = () => {\r\n    return [firstItem, ...searchStocks].filter(each => each.id !== firstItem.id);\r\n  }\r\n  console.log('firstItem', firstItem)\r\n  return (\r\n    <div className={styles.bodyMain}>\r\n      {modalShow && <div className={styles.overlay} onClick={() => hideModal()} />}\r\n      <div className={styles.stonkDiv}>\r\n        <StonksIcon />\r\n        <div className={styles.ofTheWeek}>OF THE WEEK</div>\r\n      </div>\r\n      <div className={styles.descriptionDiv}>\r\n        <div className={styles.line}>\r\n          A stonk of the week, voted by the community\r\n        </div>\r\n        <div className={styles.line}>\r\n          The DEUS Dao will conduct <span>{firstItem?.name}</span> and add liquidity for it to Uniswap.\r\n        </div>\r\n      </div>\r\n      <div className={styles.mainContainer}>\r\n        {\r\n          voteItem?.id ? (\r\n            <div className={styles.votted}>\r\n              <div className={styles.vottedText}>You have voted for {voteItem.name}</div>\r\n              <Button size=\"long\" text=\"RETRACT VOTE\" handleClick={retractVote} />\r\n            </div>\r\n          ) : null\r\n        }\r\n        <div className={styles.leaderboard}>\r\n          LEADERBOARD WEEK #1\r\n        </div>\r\n        <div className={styles.searchDiv}>\r\n          <div className={styles.searchDescription}>\r\n            Not happy with the top votes? Search, find and vote for your pick\r\n          </div>\r\n          <div className={styles.searchInputDiv}>\r\n            <input value={searchInput} placeholder=\"Search\" onChange={e => onChangeInput(e.target.value)} />\r\n          </div>\r\n          {modalShow && (\r\n            <div className={styles.modalContainer}>\r\n              {\r\n                getSearchArray().map((item, index) => {\r\n                  if(item) {\r\n                    return (\r\n                      <RankItem\r\n                        search\r\n                        voted={item.id === voteItem.id}\r\n                        key={item.id}\r\n                        onVote={() => onVote(item)}\r\n                        item={item}\r\n                        rank={1 + index}\r\n                        last={index === getSearchArray().length - 1}\r\n                      />\r\n                    )\r\n                  } else {\r\n                    return null\r\n                  }\r\n                })\r\n              }\r\n            </div>\r\n          )}\r\n        </div>\r\n        {firstItem && firstItem.name ? (\r\n          <div className={styles.firstRankDiv}>\r\n            <div className={styles.firstRankText}>#1</div>\r\n            <div className={styles.itemName}>{firstItem.ticker}</div>\r\n            <div className={styles.itemDescription}>{firstItem.name}</div>\r\n            <Button handleClick={() => onVote(firstItem)} size=\"big\" text=\"VOTE\" />\r\n            <div className={styles.details}>{firstItem?.vote?.numberOfVotes} Votes so far – {firstItem?.vote?.percentageShare}%</div>\r\n          </div>\r\n        ) : null}\r\n        <div className={styles.otherRanks}>\r\n          {\r\n            stocks && stocks.map((stock, index) => (\r\n              <RankItem onVote={() => onVote(stock)} key={stock?.vote?.id} rank={(currentPage - 1) * size + 2 + index} item={stock} last={index === (size - 1)} />\r\n            ))\r\n          }\r\n        </div>\r\n        <div className={styles.pageNavigation}>\r\n          <PageNavigation total={pages} currentPage={currentPage} setCurrentPage={setCurrentPage} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}","E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\FooterItemList\\FooterItemList.js",[],"E:\\deus\\vote.deus.finance\\src\\pages\\StonksOfWeek\\components\\RankItem\\RankItem.js",[],"E:\\deus\\vote.deus.finance\\src\\components\\Button\\Button.js",[],"E:\\deus\\vote.deus.finance\\src\\components\\PageNavigation\\PageNavigation.js",[],{"ruleId":"52","replacedBy":"53"},{"ruleId":"54","replacedBy":"55"},{"ruleId":"56","severity":1,"message":"57","line":3,"column":8,"nodeType":"58","messageId":"59","endLine":3,"endColumn":15},{"ruleId":"56","severity":1,"message":"60","line":22,"column":10,"nodeType":"58","messageId":"59","endLine":22,"endColumn":17},"no-native-reassign",["61"],"no-negated-in-lhs",["62"],"no-unused-vars","'Spinner' is defined but never used.","Identifier","unusedVar","'loading' is assigned a value but never used.","no-global-assign","no-unsafe-negation"]