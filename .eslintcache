[{"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\index.js":"1","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\reportWebVitals.js":"2","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\utils\\utils.js":"3","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\routes\\index.js":"4","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\StonksOfWeek.js":"5","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\components\\Footer\\Footer.js":"6","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\components\\MainBody\\MainBody.js":"7","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\components\\FooterItemList\\FooterItemList.js":"8","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\components\\RankItem\\RankItem.js":"9","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\components\\FormatVotes\\FormatVotes.js":"10","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\components\\Button\\Button.js":"11","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\components\\TwoButton\\TwoButton.js":"12","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\components\\PageNavigation\\PageNavigation.js":"13"},{"size":701,"mtime":1617050475002,"results":"14","hashOfConfig":"15"},{"size":375,"mtime":1617050475008,"results":"16","hashOfConfig":"15"},{"size":4974,"mtime":1617050475011,"results":"17","hashOfConfig":"15"},{"size":404,"mtime":1617098740405,"results":"18","hashOfConfig":"15"},{"size":1380,"mtime":1617098740405,"results":"19","hashOfConfig":"15"},{"size":1925,"mtime":1617050475004,"results":"20","hashOfConfig":"15"},{"size":10332,"mtime":1617050475007,"results":"21","hashOfConfig":"15"},{"size":598,"mtime":1617050475005,"results":"22","hashOfConfig":"15"},{"size":2793,"mtime":1617050475007,"results":"23","hashOfConfig":"15"},{"size":345,"mtime":1617050474978,"results":"24","hashOfConfig":"15"},{"size":633,"mtime":1617050474977,"results":"25","hashOfConfig":"15"},{"size":1148,"mtime":1617050474979,"results":"26","hashOfConfig":"15"},{"size":5584,"mtime":1617050474978,"results":"27","hashOfConfig":"15"},{"filePath":"28","messages":"29","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},"pihgf8",{"filePath":"31","messages":"32","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"35","messages":"36","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"37","messages":"38","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"39","messages":"40","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"41","messages":"42","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"43","usedDeprecatedRules":"30"},{"filePath":"44","messages":"45","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"46","messages":"47","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"48","messages":"49","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"50","messages":"51","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"52","messages":"53","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},{"filePath":"54","messages":"55","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"30"},"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\index.js",[],["56","57"],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\reportWebVitals.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\utils\\utils.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\routes\\index.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\StonksOfWeek.js",["58"],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\components\\Footer\\Footer.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\components\\MainBody\\MainBody.js",["59","60"],"import React, {useState, useEffect, useCallback} from 'react';\r\nimport Web3 from 'web3'\r\nimport Spinner from 'react-spinkit';\r\nimport { useWeb3React } from '@web3-react/core';\r\n\r\nimport Button from 'components/Button/Button';\r\nimport TwoButton from 'components/TwoButton/TwoButton';\r\nimport PageNavigation from 'components/PageNavigation/PageNavigation';\r\nimport FormatVotes from 'components/FormatVotes/FormatVotes';\r\nimport { ReactComponent as StonksIcon } from 'icons/STONKS.svg';\r\nimport RankItem from '../RankItem/RankItem';\r\nimport styles from './MainBody.module.scss';\r\n\r\nconst size = 10;\r\n\r\nexport default function MainBody() {\r\n  const [searchInput, setSearchInput] = useState('');\r\n  const [modalShow, setModalShow] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [stocks, setStocks] = useState([]);\r\n  const [searchStocks, setSearchStocks] = useState([]);\r\n  const [firstItem, setFirstItem] = useState({});\r\n  const [voteItem, setVoteItem] = useState({});\r\n  const [pages, setPages] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n  const web3React = useWeb3React()\r\n  const { account: address } = web3React\r\n\r\n  const getStocks = useCallback(() => {\r\n    return new Promise((resolve, reject) => {\r\n      const apiUrl = 'https://weeklystocks-api.herokuapp.com/stocks?search='+searchInput+'&offset='+(searchInput ? 0 : (currentPage - 1) * size + 1)+'&limit='+size+'&sort=' + (searchInput ? 'ticker,asc' : 'vote.numberOfVotes,desc&sort=ticker,asc');\r\n      fetch(apiUrl, {\r\n        method: 'GET',\r\n        headers: {\r\n          api_key: process.env.REACT_APP_API_KEY,\r\n          Accept: '*/*',\r\n          'Content-Type': 'application/json',\r\n        },\r\n      }).then(data => {\r\n        return data.json();\r\n      }).then(resp => {\r\n        if(searchInput) {\r\n          setSearchStocks(resp.stocks)\r\n        } else {\r\n          setStocks(resp.stocks)\r\n          setPages(resp.totalPages)\r\n        }\r\n        resolve(true)\r\n      }).catch(err => {\r\n        // consolg.log('getStocks err', err)\r\n        reject(err)\r\n      })\r\n    })\r\n  }, [currentPage, searchInput])\r\n\r\n  const getFirstItem = useCallback(() => {\r\n    return new Promise((resolve, reject) => {\r\n      const apiUrl = 'https://weeklystocks-api.herokuapp.com/stocks?search=&offset=0&limit=1&sort=vote.numberOfVotes,desc&sort=ticker,asc';\r\n      fetch(apiUrl, {\r\n        method: 'GET',\r\n        headers: {\r\n          api_key: process.env.REACT_APP_API_KEY,\r\n          Accept: '*/*',\r\n          'Content-Type': 'application/json',\r\n        },\r\n      }).then(data => {\r\n        return data.json();\r\n      }).then(resp => {\r\n        setFirstItem(resp.stocks[0]);\r\n        resolve();\r\n      }).catch(err => {\r\n        // consolg.log('getFirstItem err', err)\r\n        reject();\r\n      })\r\n    })\r\n  }, []);\r\n\r\n  const getVotes = useCallback(() => {\r\n    return new Promise((resolve, reject) => {\r\n      if(address) {\r\n        setLoading(true);\r\n        const apiUrl = 'https://weeklystocks-api.herokuapp.com/wallets/' + address + '/votes';\r\n        fetch(apiUrl, {\r\n          method: 'GET',\r\n          headers: {\r\n            api_key: process.env.REACT_APP_API_KEY,\r\n            Accept: '*/*',\r\n            'Content-Type': 'application/json',\r\n          },\r\n        }).then(data => {\r\n          if(data.status === 200) {\r\n            return data.json();\r\n          } else {\r\n            return {}\r\n          }\r\n        }).then(resp => {\r\n          setVoteItem(resp);\r\n          resolve();\r\n        }).catch(err => {\r\n          // consolg.log('getVotes err', err)\r\n          reject();\r\n        })\r\n      } else {\r\n        resolve();\r\n      }\r\n    })\r\n  }, [address]);\r\n\r\n  const getData = useCallback(() => {\r\n    setLoading(true);\r\n    getStocks().then(() => {\r\n      getFirstItem().then(() => {\r\n        getVotes().then(() => {\r\n          setLoading(false);\r\n        })\r\n      })\r\n    })\r\n  }, [getStocks, getFirstItem, getVotes]);\r\n\r\n  useEffect(() => {\r\n    getData();\r\n  }, [getData]);\r\n\r\n  const onChangeInput = (value) => {\r\n    setSearchInput(value);\r\n    if (value) {\r\n      document.body.style.overflow = 'hidden';\r\n      setModalShow(true);\r\n    } else {\r\n      hideModal();\r\n    }\r\n  }\r\n\r\n  const hideModal = () => {\r\n    document.body.style.overflow = 'unset';\r\n    setModalShow(false);\r\n  }\r\n\r\n  const onVote = async (item, period) => {\r\n    if(!address) {\r\n      alert('Please install metamask on your browser');\r\n      return\r\n    }\r\n    if(!voteItem?.stock?.id) {\r\n      setLoading(true);\r\n      console.log('item', item)\r\n      const apiUrl = 'https://weeklystocks-api.herokuapp.com/wallets/'+address+'/stocks/'+item?.id.toString()+'/votes';\r\n      const web3 = new Web3(Web3.givenProvider || 'http://localhost:8080')\r\n      const signature = await web3.eth.personal.sign(period + ' ' + item.ticker.toString(), address)\r\n      fetch(apiUrl, {\r\n        method: 'PUT',\r\n        headers: {\r\n          api_key: process.env.REACT_APP_API_KEY,\r\n          Accept: '*/*',\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          address: address,\r\n          message: period + ' ' + item.ticker.toString(),\r\n          signature: signature,\r\n          version: \"2\"\r\n        })\r\n      }).then(data => {\r\n        if(data.ok) {\r\n          // alert('You\\'ve voted');\r\n          getData();\r\n        } else {\r\n          setLoading(false)\r\n        }\r\n      }).catch(err => {\r\n        // consolg.log('onVote err', err)\r\n        setLoading(false);\r\n      })\r\n    } else {\r\n      alert('You\\'ve already voted already for this week');\r\n    }\r\n  }\r\n\r\n  const retractVote = async () => {\r\n    setLoading(true);\r\n    const apiUrl = 'https://weeklystocks-api.herokuapp.com/wallets/'+address+'/stocks/'+voteItem?.stock?.id.toString()+'/votes';\r\n    const web3 = new Web3(Web3.givenProvider || 'http://localhost:8080')\r\n    const signature = await web3.eth.personal.sign(voteItem?.positionType + ' ' + voteItem?.stock?.ticker.toString(), address)\r\n    fetch(apiUrl, {\r\n      method: 'DELETE',\r\n      headers: {\r\n        api_key: process.env.REACT_APP_API_KEY,\r\n        Accept: '*/*',\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        address: address,\r\n        message: voteItem?.positionType + ' ' + voteItem?.stock?.ticker.toString(),\r\n        signature: signature,\r\n        version: \"2\"\r\n      })\r\n    }).then(data => {\r\n      if(data.ok) {\r\n        // alert('You\\'ve retracted');\r\n        getData();\r\n      } else {\r\n        setLoading(false);\r\n      }\r\n    }).catch(err => {\r\n      // consolg.log('retractVote err', err)\r\n      setLoading(false);\r\n    })\r\n  }\r\n\r\n  const getSearchArray = () => {\r\n    return [firstItem, ...searchStocks].filter(each => each?.id !== firstItem?.id);\r\n  }\r\n  return (\r\n    <div className={styles.bodyMain}>\r\n      {modalShow && <div className={styles.overlay} onClick={() => hideModal()} />}\r\n      <div className={styles.stonkDiv}>\r\n        <StonksIcon />\r\n        <div className={styles.ofTheWeek}>OF THE WEEK</div>\r\n      </div>\r\n      <div className={styles.descriptionDiv}>\r\n        <div className={styles.line}>\r\n          A stonk of the week, voted by the community\r\n        </div>\r\n        <div className={styles.line}>\r\n          The DEUS DAO Team will conduct <span>{firstItem?.name}</span> and open a Pool on your favorite DEX and start an internal Liquidity Mining event.\r\n        </div>\r\n      </div>\r\n      <div className={styles.mainContainer}>\r\n        {\r\n          voteItem?.stock?.id ? (\r\n            <div className={styles.votted}>\r\n              <div className={styles.vottedText}>You have voted for {voteItem?.stock?.name} ({voteItem?.positionType})</div>\r\n              <Button size=\"long\" text=\"RETRACT VOTE\" handleClick={retractVote} />\r\n            </div>\r\n          ) : null\r\n        }\r\n        <div className={styles.leaderboard}>\r\n          LEADERBOARD WEEK #1\r\n        </div>\r\n        <div className={styles.searchDiv}>\r\n          <div className={styles.searchDescription}>\r\n            Not happy with the top votes? Search, find and vote for your pick\r\n          </div>\r\n          <div className={styles.searchInputDiv}>\r\n            <input value={searchInput} placeholder=\"Search\" onChange={e => onChangeInput(e.target.value)} />\r\n          </div>\r\n          {modalShow && (\r\n            <div className={styles.modalContainer}>\r\n              {\r\n                getSearchArray().map((item, index) => {\r\n                  if(item) {\r\n                    return (\r\n                      <RankItem\r\n                        search\r\n                        voted={item?.stock?.id === voteItem?.stock?.id}\r\n                        key={item?.stock?.id}\r\n                        onVote={onVote}\r\n                        item={item}\r\n                        rank={1 + index}\r\n                        last={index === getSearchArray().length - 1}\r\n                      />\r\n                    )\r\n                  } else {\r\n                    return null\r\n                  }\r\n                })\r\n              }\r\n            </div>\r\n          )}\r\n        </div>\r\n        {firstItem && firstItem.name ? (\r\n          <div className={styles.firstRankDiv}>\r\n            <div className={styles.firstRankText}>#1</div>\r\n            <div className={styles.itemName}>{firstItem.ticker}</div>\r\n            <div className={styles.itemDescription}>{firstItem.name}</div>\r\n            <TwoButton leftClick={() => onVote(firstItem, 'short')} rightClick={() => onVote(firstItem, 'long')} size=\"big\" leftText=\"SHORT\" rightText=\"LONG\" />\r\n            <div className={styles.details}>{firstItem?.vote?.numberOfVotes} <FormatVotes short={firstItem?.vote?.votesShort} long={firstItem?.vote?.votesLong} /> – {firstItem?.vote?.percentageShare}%</div>\r\n          </div>\r\n        ) : null}\r\n        <div className={styles.otherRanks}>\r\n          {\r\n            stocks && stocks.map((stock, index) => (\r\n              <RankItem onVote={onVote} key={stock?.vote?.id} rank={(currentPage - 1) * size + 2 + index} item={stock} last={index === (size - 1)} />\r\n            ))\r\n          }\r\n        </div>\r\n        <div className={styles.pageNavigation}>\r\n          <PageNavigation total={pages} currentPage={currentPage} setCurrentPage={setCurrentPage} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}","E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\components\\FooterItemList\\FooterItemList.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\pages\\StonksOfWeek\\components\\RankItem\\RankItem.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\components\\FormatVotes\\FormatVotes.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\components\\Button\\Button.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\components\\TwoButton\\TwoButton.js",[],"E:\\Work\\Nathan\\DeusFinance\\SOTW\\src\\components\\PageNavigation\\PageNavigation.js",[],{"ruleId":"61","replacedBy":"62"},{"ruleId":"63","replacedBy":"64"},{"ruleId":"65","severity":1,"message":"66","line":11,"column":9,"nodeType":"67","messageId":"68","endLine":11,"endColumn":16},{"ruleId":"65","severity":1,"message":"69","line":3,"column":8,"nodeType":"67","messageId":"68","endLine":3,"endColumn":15},{"ruleId":"65","severity":1,"message":"70","line":25,"column":10,"nodeType":"67","messageId":"68","endLine":25,"endColumn":17},"no-native-reassign",["71"],"no-negated-in-lhs",["72"],"no-unused-vars","'context' is assigned a value but never used.","Identifier","unusedVar","'Spinner' is defined but never used.","'loading' is assigned a value but never used.","no-global-assign","no-unsafe-negation"]